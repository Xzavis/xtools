<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - XTools</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/shadcn-theme.css') }}">
    <style>
        .page-header { margin-bottom: 2rem; }
        .page-title { font-size: 1.875rem; font-weight: 600; letter-spacing: -0.025em; color: hsl(var(--foreground)); }
        .page-description { font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem; }
        .settings-card { background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 1.5rem; }
        .settings-card-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid hsl(var(--border)); }
        .settings-card-title { font-size: 1.125rem; font-weight: 600; color: hsl(var(--foreground)); }
        .settings-card-icon { width: 40px; height: 40px; background: hsl(var(--primary) / 0.1); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: hsl(var(--primary)); }
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; font-size: 0.875rem; font-weight: 500; color: hsl(var(--foreground)); margin-bottom: 0.5rem; }
        .form-description { font-size: 0.75rem; color: hsl(var(--muted-foreground)); margin-bottom: 0.5rem; }
        .input-wrapper { position: relative; }
        .input-icon { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: hsl(var(--muted-foreground)); pointer-events: none; }
        .form-input { width: 100%; padding: 0.5rem 0.75rem 0.5rem 2.5rem; background: hsl(var(--background)); border: 1px solid hsl(var(--border)); border-radius: var(--radius-md); font-size: 0.875rem; color: hsl(var(--foreground)); transition: all 0.2s ease; }
        .form-input:focus { outline: none; border-color: hsl(var(--ring)); box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s ease; border: none; }
        .btn-primary { background: hsl(var(--primary)); color: hsl(var(--primary-foreground)); }
        .btn-primary:hover { background: hsl(var(--primary) / 0.9); }
        .btn-outline { background: transparent; border: 1px solid hsl(var(--border)); color: hsl(var(--foreground)); }
        .btn-outline:hover { background: hsl(var(--muted)); }
        .alert { padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem; display: flex; align-items: flex-start; gap: 0.75rem; }
        .alert-info { background: hsl(var(--primary) / 0.1); border: 1px solid hsl(var(--primary) / 0.2); color: hsl(var(--primary)); }
        .alert-success { background: hsl(var(--success) / 0.1); border: 1px solid hsl(var(--success) / 0.2); color: hsl(var(--success)); }
        .alert-icon { flex-shrink: 0; margin-top: 0.125rem; }
        .alert-content { flex: 1; }
        .alert-title { font-weight: 600; margin-bottom: 0.25rem; }
        .alert-description { font-size: 0.875rem; opacity: 0.9; }
        .status-badge { display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.25rem 0.75rem; border-radius: var(--radius-full); font-size: 0.75rem; font-weight: 500; }
        .status-badge-success { background: hsl(var(--success) / 0.1); color: hsl(var(--success)); }
        .status-badge-error { background: hsl(var(--destructive) / 0.1); color: hsl(var(--destructive)); }
        .token-status-dot { width: 6px; height: 6px; border-radius: 50%; }
        .help-link { color: hsl(var(--primary)); text-decoration: none; font-weight: 500; }
        .help-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    {% include 'sidebar.html' %}
    <div class="main-content">
        <div class="page-header">
            <div>
                <h1 class="page-title">Settings</h1>
                <p class="page-description">Configure your API tokens and preferences</p>
            </div>
        </div>
        <div class="alert alert-info">
            <i data-lucide="info" class="alert-icon" style="width: 20px; height: 20px;"></i>
            <div class="alert-content">
                <div class="alert-title">Hugging Face Token Required</div>
                <div class="alert-description">
                    To use Model Hub features like searching and downloading models/datasets, you need a Hugging Face access token. 
                    <a href="https://huggingface.co/settings/tokens" target="_blank" class="help-link">Get your token here</a>
                </div>
            </div>
        </div>
        <div id="successAlert" class="alert alert-success" style="display: none;">
            <i data-lucide="check-circle" class="alert-icon" style="width: 20px; height: 20px;"></i>
            <div class="alert-content">
                <div class="alert-title">Settings Saved</div>
                <div class="alert-description">Your Hugging Face token has been saved successfully.</div>
            </div>
        </div>
        <div class="settings-card">
            <div class="settings-card-header">
                <div class="settings-card-icon">
                    <i data-lucide="key" style="width: 20px; height: 20px;"></i>
                </div>
                <div style="flex: 1;">
                    <h2 class="settings-card-title">Hugging Face Token</h2>
                    <p style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Required for accessing Model Hub features</p>
                </div>
                <span id="tokenStatusBadge" class="status-badge status-badge-error">
                    <span class="token-status-dot" style="background: currentColor;"></span>Not Configured
                </span>
            </div>
            <div class="form-group">
                <label class="form-label" for="hfToken">Access Token</label>
                <p class="form-description">Enter your Hugging Face access token. The token will be stored locally on this machine.</p>
                <div class="input-wrapper">
                    <i data-lucide="lock" class="input-icon" style="width: 16px; height: 16px;"></i>
                    <input type="password" id="hfToken" class="form-input" placeholder="hf_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                </div>
            </div>
            <div style="display: flex; gap: 0.75rem;">
                <button class="btn btn-primary" onclick="saveSettings()">
                    <i data-lucide="save" style="width: 16px; height: 16px;"></i>Save Token
                </button>
                <button class="btn btn-outline" onclick="clearToken()">
                    <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>Clear
                </button>
            </div>
        </div>
        <div class="settings-card">
            <div class="settings-card-header">
                <div class="settings-card-icon">
                    <i data-lucide="book-open" style="width: 20px; height: 20px;"></i>
                </div>
                <div><h2 class="settings-card-title">How to Get Your Token</h2></div>
            </div>
            <div style="display: grid; gap: 1rem;">
                <div style="display: flex; gap: 1rem; align-items: flex-start;">
                    <div style="width: 28px; height: 28px; background: hsl(var(--primary)); color: hsl(var(--primary-foreground)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: 600; flex-shrink: 0;">1</div>
                    <div>
                        <p style="font-size: 0.875rem; color: hsl(var(--foreground)); font-weight: 500;">Go to Hugging Face Settings</p>
                        <p style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Visit <a href="https://huggingface.co/settings/tokens" target="_blank" class="help-link">huggingface.co/settings/tokens</a> and sign in.</p>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; align-items: flex-start;">
                    <div style="width: 28px; height: 28px; background: hsl(var(--primary)); color: hsl(var(--primary-foreground)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: 600; flex-shrink: 0;">2</div>
                    <div>
                        <p style="font-size: 0.875rem; color: hsl(var(--foreground)); font-weight: 500;">Create New Token</p>
                        <p style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Click "New token", name it "XTools", select "Read" permission.</p>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; align-items: flex-start;">
                    <div style="width: 28px; height: 28px; background: hsl(var(--primary)); color: hsl(var(--primary-foreground)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: 600; flex-shrink: 0;">3</div>
                    <div>
                        <p style="font-size: 0.875rem; color: hsl(var(--foreground)); font-weight: 500;">Copy and Paste</p>
                        <p style="font-size: 0.875rem; color: hsl(var(--muted-foreground)); margin-top: 0.25rem;">Copy the token (starts with "hf_") and paste it above, then click Save.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        lucide.createIcons();
        document.addEventListener('DOMContentLoaded', async function() { await loadSettings(); });
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                const result = await response.json();
                if(result.success && result.settings) {
                    if(result.settings.hf_token) {
                        document.getElementById('hfToken').placeholder = result.settings.hf_token;
                        updateTokenStatus(true);
                    } else { updateTokenStatus(false); }
                }
            } catch(e) { console.error('Failed to load settings:', e); }
        }
        function updateTokenStatus(configured) {
            const badge = document.getElementById('tokenStatusBadge');
            if(configured) {
                badge.className = 'status-badge status-badge-success';
                badge.innerHTML = '<span class="token-status-dot" style="background: currentColor;"></span>Configured';
            } else {
                badge.className = 'status-badge status-badge-error';
                badge.innerHTML = '<span class="token-status-dot" style="background: currentColor;"></span>Not Configured';
            }
        }
        async function saveSettings() {
            const token = document.getElementById('hfToken').value.trim();
            if(!token) { alert('Please enter a token'); return; }
            if(!token.startsWith('hf_')) { alert('Invalid token format. Token should start with "hf_"'); return; }
            try {
                const response = await fetch('/api/settings', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({hf_token: token}) });
                const result = await response.json();
                if(result.success) {
                    document.getElementById('successAlert').style.display = 'flex';
                    setTimeout(() => { document.getElementById('successAlert').style.display = 'none'; }, 5000);
                    updateTokenStatus(true);
                    document.getElementById('hfToken').value = '';
                    const maskedToken = token.substring(0, 4) + '*'.repeat(token.length - 8) + token.substring(token.length - 4);
                    document.getElementById('hfToken').placeholder = maskedToken;
                    const indicator = document.getElementById('tokenStatusIndicator');
                    if(indicator) { indicator.style.background = 'hsl(var(--success))'; indicator.title = 'HF Token configured'; }
                } else { alert('Failed to save: ' + (result.error || 'Unknown error')); }
            } catch(e) { alert('Error saving settings: ' + e.message); }
        }
        async function clearToken() {
            if(!confirm('Are you sure you want to remove your Hugging Face token?')) return;
            try {
                const response = await fetch('/api/settings', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({hf_token: ''}) });
                const result = await response.json();
                if(result.success) {
                    document.getElementById('hfToken').value = '';
                    document.getElementById('hfToken').placeholder = 'hf_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';
                    updateTokenStatus(false);
                    const indicator = document.getElementById('tokenStatusIndicator');
                    if(indicator) { indicator.style.background = 'hsl(var(--destructive))'; indicator.title = 'HF Token not configured'; }
                }
            } catch(e) { alert('Error clearing token: ' + e.message); }
        }
    </script>
</body>
</html>
